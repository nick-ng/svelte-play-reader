import{a as L,t as O,c as qe}from"../chunks/CIYkWqsw.js";import"../chunks/5xf3rXQf.js";import{aH as Ce,Y as s,Z as a,$ as ve,_ as r,a as e,V as C,N as be,X as b,b as u,Q as oe,T as ye,W as $e,K as fe,aL as Ne,j as Ee}from"../chunks/B4Ye32uY.js";import{l as Le,s as $,e as me}from"../chunks/BdW3lM8a.js";import{s as ie,b as he,r as de,a as We}from"../chunks/C7KqxU5o.js";import{e as ne,i as se,a as je,b as pe}from"../chunks/B7JdpwPN.js";import{i as xe}from"../chunks/CfbhqvxB.js";import{i as Be,s as Se,b as Ie}from"../chunks/C6efE479.js";import{o as Pe}from"../chunks/CDqKfrdJ.js";import{c as ge,C as De}from"../chunks/se3ZZrr-.js";import{i as Ue}from"../chunks/Ddome9sk.js";import{p as K}from"../chunks/sPTkFuJ7.js";function Te(t){var n,l,i="";if(typeof t=="string"||typeof t=="number")i+=t;else if(typeof t=="object")if(Array.isArray(t)){var c=t.length;for(n=0;n<c;n++)t[n]&&(l=Te(t[n]))&&(i&&(i+=" "),i+=l)}else for(l in t)t[l]&&(i&&(i+=" "),i+=l);return i}function Ge(){for(var t,n,l=0,i="",c=arguments.length;l<c;l++)(t=arguments[l])&&(n=Te(t))&&(i&&(i+=" "),i+=n);return i}function Re(t){return typeof t=="object"?Ge(t):t??""}function Ve(t,n,l){if(t.multiple)return He(t,n);for(var i of t.options){var c=ue(i);if(Be(c,n)){i.selected=!0;return}}(!l||n!==void 0)&&(t.selectedIndex=-1)}function Oe(t,n){Ce(()=>{var l=new MutationObserver(()=>{var i=t.__value;Ve(t,i)});return l.observe(t,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),()=>{l.disconnect()}})}function ze(t,n,l=n){var i=!0;Le(t,"change",c=>{var v=c?"[selected]":":checked",I;if(t.multiple)I=[].map.call(t.querySelectorAll(v),ue);else{var x=t.querySelector(v)??t.querySelector("option:not([disabled])");I=x&&ue(x)}l(I)}),Ce(()=>{var c=n();if(Ve(t,c,i),i&&c===void 0){var v=t.querySelector(":checked");v!==null&&(c=ue(v),l(c))}t.__value=c,i=!1}),Oe(t)}function He(t,n){for(var l of t.options)l.selected=~n.indexOf(ue(l))}function ue(t){return"__value"in t?t.__value:t.value}const Je=({phrase:t,voice:n,volume:l,rate:i,pitch:c})=>{const v=new SpeechSynthesisUtterance(t);return n&&(v.voice=n),v.rate=i,v.volume=l,v.pitch=c,speechSynthesis.speak(v),v};var Ke=O('<p class="mx-1"> </p>'),Qe=O("<div> </div>"),Xe=O('<td class="relative bg-inherit px-2 py-1 align-top font-bold"><div class="sticky top-0 bg-inherit"> </div></td> <td class="px-2 py-1 align-top"></td> <td class="px-2 py-1 text-xs"> </td>',1),Ye=O('<td colspan="2" class="px-2 py-1 align-top text-lg italic"><span class="capitalize"> </span> </td> <td class="px-2 py-1 text-xs"> </td>',1),Ze=O("<tr><!></tr>"),et=O('<h3 class="mx-1"> </h3> <!> <table class="max-w-prose"><tbody></tbody></table>',1),tt=O('<div class="my-2 max-h-96 overflow-y-scroll rounded-sm border border-gray-500"><h2 class="mx-1">Stage</h2> <div></div></div>');function rt(t,n){let l=K(n,"scenes",24,()=>[]),i=K(n,"currentStep",8,""),c=K(n,"currentFeet",8,"");var v=tt(),I=s(a(v),2);ne(I,5,l,se,(x,o)=>{var W=et(),y=ve(W),P=a(y);r(y);var T=s(y,2);ne(T,1,()=>e(o).settings,se,(p,m)=>{var _=Ke(),f=a(_,!0);r(_),C(()=>$(f,e(m))),L(p,_)});var k=s(T,2),g=a(k);ne(g,5,()=>e(o).steps,se,(p,m,_)=>{var f=Ze(),A=a(f);{var z=w=>{var j=Xe(),B=ve(j),H=a(B),D=a(H);r(H),r(B);var F=s(B,2);ne(F,5,()=>e(m).feets,se,(Q,X,q)=>{var V=Qe(),ee=a(V,!0);r(V),C(()=>{ie(V,"id",`a${e(o).act}_s${e(o).scene}_${_}_${q}`),he(V,Re(c()===`a${e(o).act}_s${e(o).scene}_${_}_${q}`?"underline":"")),$(ee,e(X))}),L(Q,V)}),r(F);var M=s(F,2),G=a(M,!0);r(M),C(()=>{$(D,`${e(m).character??""}.`),$(G,`a${e(o).act}_s${e(o).scene}_${_}`)}),L(w,j)},ce=w=>{var j=qe(),B=ve(j);{var H=D=>{var F=Ye(),M=ve(F),G=a(M),Q=a(G,!0);r(G);var X=s(G);C(()=>$(X,` ${e(m).characterNames.join(e(m).timing==="sequential"?" then ":", ")??""}`)),r(M);var q=s(M,2),V=a(q,!0);r(q),C(()=>{$(Q,e(m).direction),$(V,`a${e(o).act}_s${e(o).scene}_${_}`)}),L(D,F)};Ue(B,D=>{e(m).type==="stage-direction"&&e(m).subType==="movement"&&D(H)},!0)}L(w,j)};Ue(A,w=>{e(m).type==="character-lines"?w(z):w(ce,!1)})}r(f),C(()=>{ie(f,"id",`a${e(o).act}_s${e(o).scene}_${_}`),he(f,Re(`a${e(o).act}_s${e(o).scene}_${_}`===i()?"bg-green-200 dark:bg-green-800":"odd-rows"))}),L(p,f)}),r(g),r(k),C(()=>$(P,`Act: ${e(o).act??""}, Scene: ${e(o).scene??""}`)),L(x,W)}),r(I),r(v),L(t,v)}var at=O('<div><label class="inline-block w-2/3 overflow-x-hidden text-ellipsis whitespace-nowrap align-text-bottom"><input class="align-middle" type="radio"> </label> <div class="inline-block align-text-bottom"> </div> <button class="inline-block align-text-bottom">Test</button></div>'),nt=O('<details><summary> </summary> <table><tbody><tr><td>Speech Rate</td><td><input type="range" min="0.1" max="2" step="0.1"></td></tr><tr><td>Speech Pitch</td><td><input type="range" min="0.1" max="2" step="0.1"></td></tr><tr><td>Gender</td><td><select><option>Female</option><option>Male</option></select></td></tr></tbody></table> <div><input type="text"> <button>Stop Talking</button> <div class="max-h-48 overflow-y-scroll"></div> <button>Save</button></div></details>');function st(t,n){var te,Z,E,re;be(n,!1);const[l,i]=Se(),c=()=>Ie(We,"$actorsStore",l),v=b(),I=[];let x=K(n,"character",8),o=K(n,"castMember",8),W=K(n,"volume",8),y=K(n,"totalWords",8),P=K(n,"handleSave",8);const T={rate:1,pitch:1,gender:"female",age:"adult"};let k=b(((te=o())==null?void 0:te.rate)||T.rate),g=b(((Z=o())==null?void 0:Z.pitch)||T.pitch),p=b(((E=o())==null?void 0:E.gender)||T.gender),m=b(((re=o())==null?void 0:re.voiceURI)||void 0),_=b(""),f=b([]);Pe(()=>{u(f,speechSynthesis.getVoices()),speechSynthesis.addEventListener("voiceschanged",()=>{u(f,speechSynthesis.getVoices())})}),oe(()=>(e(f),c(),e(p)),()=>{u(f,e(f).sort((d,h)=>{const U=c()[d.voiceURI],S=c()[h.voiceURI],R=`${d.lang}${d.name}`.localeCompare(`${h.lang}${h.name}`);return!U&&!S?R:U&&!S?-1:S&&!U?1:U.gender===e(p)&&S.gender!==e(p)?-1:S.gender===e(p)&&U.gender!==e(p)?1:U.fluency!==S.fluency?S.fluency-U.fluency:`${d.lang}${d.name}`.localeCompare(`${h.lang}${h.name}`)}))}),oe(()=>(e(f),fe(o())),()=>{u(v,e(f).find(d=>{var h;return d.voiceURI===((h=o())==null?void 0:h.voiceURI)}))}),ye(),xe();var A=nt(),z=a(A),ce=a(z);C(()=>{var d;return $(ce,`${x().name??""} - ${(x().words/y()*100).toFixed(1)??""}% ${((d=e(v))!=null&&d.name?`- ${e(v).name}`:"")??""}`)}),r(z);var w=s(z,2),j=a(w),B=a(j),H=s(a(B)),D=a(H);de(D),r(H),r(B);var F=s(B),M=s(a(F)),G=a(M);de(G),r(M),r(F);var Q=s(F),X=s(a(Q)),q=a(X);C(()=>{e(p),Ne(()=>{})});var V=a(q);V.value=(V.__value="female")==null?"":"female";var ee=s(V);ee.value=(ee.__value="male")==null?"":"male",r(q),r(X),r(Q),r(j),r(w);var le=s(w,2),Y=a(le);de(Y);var N=s(Y,4);ne(N,5,()=>e(f),se,(d,h)=>{var U=at(),S=a(U),R=a(S);de(R);var ke,Ae=s(R);r(S);var _e=s(S,2),Fe=a(_e);r(_e);var Me=s(_e,2);r(U),C(()=>{var J,we;he(U,`${((J=o())==null?void 0:J.voiceURI)===e(h).voiceURI?"bg-green-200 dark:bg-green-800":"odd-rows"} p-1`),ie(R,"name",`voice-${x().name}`),ke!==(ke=e(h).voiceURI)&&(R.value=(R.__value=e(h).voiceURI)==null?"":e(h).voiceURI),$(Ae,` (${e(h).lang??""}) ${e(h).name??""}`),$(Fe,`- ${((we=c()[e(h).voiceURI])==null?void 0:we.fluency)??""}`)}),je(I,[],R,()=>(e(h).voiceURI,e(m)),J=>u(m,J)),me("click",Me,()=>{speechSynthesis.cancel();const J=new SpeechSynthesisUtterance(e(h).name);J.voice=e(h),J.rate=e(k),J.pitch=e(g),J.volume=W(),speechSynthesis.speak(J)}),L(d,U)}),r(N);var ae=s(N,2);r(le),r(A),C(()=>{var d;return A.open=!((d=o())!=null&&d.voiceURI)}),pe(D,()=>e(k),d=>u(k,d)),pe(G,()=>e(g),d=>u(g,d)),ze(q,()=>e(p),d=>u(p,d)),pe(Y,()=>e(_),d=>u(_,d)),me("click",ae,()=>{const d={character:x().name,gender:e(p),pitch:e(g),rate:e(k),voiceURI:e(m)};P()(d)}),L(t,A),$e(),i()}var ot=O('<div class="basis-prose"><h1>Cast</h1> <p> </p> <div></div></div>');function it(t,n){be(n,!1);const[l,i]=Se(),c=()=>Ie(ge,"$currentProductionStore",l),v=b(),I=b(),x=b();let o=K(n,"compiler",8),W=K(n,"volume",8);oe(()=>c(),()=>{var g;u(v,((g=c())==null?void 0:g.cast)||[])}),oe(()=>(fe(o()),c()),()=>{u(I,o().dramatisPersonae.filter(g=>{var p;return!((p=c())!=null&&p.cast.find(m=>m.character===g.name))}))}),oe(()=>fe(o()),()=>{u(x,o().dramatisPersonae.reduce((g,p)=>g+p.words,0))}),ye(),xe();var y=ot(),P=s(a(y),2),T=a(P);r(P);var k=s(P,2);ne(k,5,()=>o().dramatisPersonae,se,(g,p)=>{const m=Ee(()=>e(v).find(_=>_.character===e(p).name));st(g,{get castMember(){return e(m)},get character(){return e(p)},get volume(){return W()},get totalWords(){return e(x)},handleSave:_=>{ge.update(f=>{const A=f.cast;return{...f,cast:A.filter(z=>z.character!==_.character).concat([_])}})}})}),r(k),r(y),C(()=>$(T,`Uncast Characters: ${e(I).length??""}`)),L(t,y),$e(),i()}var ct=O('<!> <div class="basis-prose"><h1>Produce</h1> <table class="border-separate border-spacing-1"><tbody><tr><td>Speaking Character</td><td> </td></tr><tr><td>Actor</td><td> </td></tr><tr><td>Step ID</td><td> </td></tr></tbody></table> <!> <button>Play</button> <button>Stop</button> <details><summary>Debug</summary> <pre> </pre></details></div> <div class="basis-prose"><h1>Controls</h1> <label>Volume: <input class="align-text-bottom" type="range"></label></div>',1);function $t(t,n){be(n,!1);const[l,i]=Se(),c=()=>Ie(ge,"$currentProductionStore",l),v=b();let I=b(""),x=b(""),o=b(0),W=b(!0),y=b(""),P=b(""),T=b(.3),k=b([]);Pe(()=>{u(k,speechSynthesis.getVoices()),speechSynthesis.addEventListener("voiceschanged",()=>{u(k,speechSynthesis.getVoices())})}),oe(()=>c(),()=>{var N;u(v,new De(((N=c())==null?void 0:N.sourceText)||""))}),ye(),xe();var g=ct(),p=ve(g);it(p,{get compiler(){return e(v)},get volume(){return e(T)}});var m=s(p,2),_=s(a(m),2),f=a(_),A=a(f),z=s(a(A)),ce=a(z,!0);r(z),r(A);var w=s(A),j=s(a(w)),B=a(j,!0);r(j),r(w);var H=s(w),D=s(a(H)),F=a(D,!0);r(D),r(H),r(f),r(_);var M=s(_,2);rt(M,{get scenes(){return e(v).scenes},get currentStep(){return e(y)},get currentFeet(){return e(P)}});var G=s(M,2),Q=s(G,2),X=s(Q,2),q=s(a(X),2),V=a(q,!0);C(()=>$(V,JSON.stringify(e(v).scenes,null,"  "))),r(q),r(X),r(m);var ee=s(m,2),le=s(a(ee),2),Y=s(a(le));de(Y),ie(Y,"min",0),ie(Y,"max",1),ie(Y,"step",.01),r(le),r(ee),C(()=>{$(ce,e(I)),$(B,e(x)),$(F,e(y)?`${e(y)}: ${e(o)}`:"")}),me("click",G,async()=>{u(W,!1);for(let N=0;N<e(v).scenes.length;N++){const ae=e(v).scenes[N];for(let te=0;te<ae.steps.length;te++){u(y,`a${ae.act}_s${ae.scene}_${te}`);const Z=ae.steps[te];if(Z.type==="stage-direction"){const E=document.getElementById(e(y));E==null||E.scrollIntoView({behavior:"smooth",block:"center"}),await new Promise(re=>{setTimeout(re,500)})}else if(Z.type==="character-lines")for(let E=0;E<Z.feets.length;E++){if(e(W))return;const re=c().cast.find(R=>R.character===Z.character),d=re&&e(k).find(R=>R.voiceURI===re.voiceURI)||null,h=Z.feets[E],U=Je({phrase:h,voice:d,volume:e(T),rate:1,pitch:1});u(I,Z.character),u(x,(d==null?void 0:d.name)||""),u(o,E),u(P,`${e(y)}_${E}`);const S=document.getElementById(e(P));S==null||S.scrollIntoView({behavior:"smooth",block:"center"}),await new Promise(R=>{U.onend=()=>{R(null)}})}}}u(W,!0),u(y,""),u(P,"")}),me("click",Q,()=>{speechSynthesis.cancel(),u(W,!0),u(y,""),u(P,"")}),pe(Y,()=>e(T),N=>u(T,N)),L(t,g),$e(),i()}export{$t as component};
